---
title: "Task 5"
author: "Oleg Arnaut"
date: "2023-11-26"
output: html_document
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
```

# Инструкции

Ниже приведены семь клинических гипотез. В качестве задания протестируйте их, используя соответствующие статистические критерии. Решение должно содержать все элементы алгоритма проверки статистических гипотез:

• Сформулируете нулевую и альтернативную гипотезы.

• Укажите уровень значимости α.

• Определите статистический тест (критерий) для проверки гипотезы. При необходимости аргументируйте выбор одностороннего теста.

• Укажите критическое значение статистики (используйте распределения из материалов лекции).

• Определите наблюдаемое значение статистики.

• Оцените статистическую значимость (p-value и/или доверительный интервал).

• Оцените практическую значимость.


*Данные для анализа необходимо генерировать самостоятельно в соответствии с каждой представленной гипотезой. По возможности используйте пакет dplyr


# Гипотеза 1. Существует ассоциация между уровнем физической активности (бинарная переменная, физическая активность может быть 'высокой' и 'низкой') и частотой возникновения сердечно-сосудистых заболеваний у пациентов старше 50 лет. Попробуйте вариант с большими выборками (sample_size <- 100). Как изменится стратегия при малых выборках (sample_size <- 30) ? 

* Сформулируем гипотезы:

Нулевая гипотеза (H0): Нет разницы в частоте возникновения сердечно-сосудистых заболеваний между группами с высоким и низким уровнем физической активности.
Альтернативная гипотеза (H1): Существует разница в частоте возникновения сердечно-сосудистых заболеваний между группами.

* Уровень значимости (α):

Обычно принимается стандартный уровень значимости 0.05.

* Статистический тест (критерий):

Мы будем использовать z-критерий для разности долей, так как у нас бинарные переменные.

* Критическое значение статистики:

$\chi^2=3.841$


## Генерация данных

```{r}
# Воспроизводимость результатов
set.seed(42)

# Общий размер выборки 
sample_size <- 100

# Генерация данных по физической активности (бинарная переменная) в фиксированном соотношении 1:1
activity <- sample(c("высокая", "низкая"), size = sample_size, replace = TRUE)

# Генерация данных по наличию сердечно-сосудистых заболеваний (бинарная переменная)
# У активных людей меньше вероятность заболеть (0.5 vs 0.6)
cardio <- ifelse(activity == "высокая", rbinom(sample_size, 1, 0.5), rbinom(sample_size, 1, 0.6))
```

```{r}
# Воспроизводимость результатов
set.seed(42)

# Общий размер выборки
sample_size <- 30

# Генерация данных по физической активности (бинарная переменная) в фиксированном соотношении 1:1
activity <- sample(c("высокая", "низкая"), size = sample_size, replace = TRUE)

# Генерация данных по наличию сердечно-сосудистых заболеваний (бинарная переменная)
# У активных людей меньше вероятность заболеть (0.5 vs 0.6)
cardio <- ifelse(activity == "высокая", rbinom(sample_size, 1, 0.5), rbinom(sample_size, 1, 0.6))
```
## Решение
```{r}
# Создание таблицы данных
data <- data.frame(activity, cardio)

# Расчет статистики и p-value
result <- prop.test(table(data$activity, data$cardio))
result
```
* Наблюдаемое значение статистики:

$\chi^2=3.0613$

* Оценка статистической значимости:

Уровень значимости (p-value) равен 0.08018, что больше стандартного уровня значимости 0.05. Следовательно, мы не можем отвергнуть нулевую гипотезу.

При уменьшении размера выборки до 30, мы можем изменить стратегию и использовать точный тест Фишера для анализа связи между уровнем физической активности и частотой сердечно-сосудистых заболеваний. Точный тест Фишера подходит для анализа связи между двумя бинарными переменными, особенно когда размер выборки мал.

```{r}
# Создание таблицы данных
data <- data.frame(activity, cardio)

# Расчет статистики и p-value с использованием точного теста Фишера
fisher_test <- fisher.test(table(data$activity, data$cardio))
fisher_test
```

* Наблюдаемое значение статистики:

$\chi^2=4.5523$

* Оценка статистической значимости:

Уровень значимости (p-value) равен 0.05773, что больше стандартного уровня значимости 0.05, что больше стандартного уровня значимости 0.05. Следовательно, мы не можем отвергнуть нулевую гипотезу.
Доверительный интервал (0.8713041; 70.4685096) содержит 1, что подтверждает статистическую незначимость результата.


# Гипотеза 2. Применение нового метода лечения для пациентов с артериальной гипертензией приведет к уменьшению среднего артериального давления по сравнению с пациентами, получающими стандартное лечение.


## Генерация данных 

```{r}
# Воспроизводимость результатов
set.seed(42)

# Размер выборки (в каждой группе)
sample_size <- 80

# В популяции с экспериментальным методом лечения средний уровень систолического артериального давления меньше (130 vs 135 mm) 
# Генерация данных для группы с новым методом лечения 
group1 <- rnorm(sample_size, mean = 130, sd = 10)  # экспериментальная группа

# Генерация данных для группы со стандартным лечением
group2 <- rnorm(sample_size, mean = 135, sd = 10)  # контрольная группа
```

## Решение

* Сформулируем гипотезы:

Нулевая гипотеза (H0): Средние уровни систолического артериального давления одинаковы для пациентов с новым методом лечения и для пациентов, получающих стандартное лечение.
Альтернативная гипотеза (H1): Существует различие в средних уровнях систолического артериального давления между группами.

* Уровень значимости (α):

Обычно принимается стандартный уровень значимости 0.05.
* Статистический тест (критерий):

Мы будем использовать t-тест для независимых выборок.

* Критическое значение статистики:

$t=2.0262$


```{r}
# Расчет статистики и p-value
t_test_result <- t.test(group1, group2)
t_test_result
```
* Наблюдаемое значение статистики:

$t=-2.178$

* Оценка статистической значимости:

$p-value=0.03586$, что позволяет отвергнуть нулевую гипотезу. Доверительный интервал (-16.1584955  -0.5832682) не включает 0, что подтверждает значимость различий.

* Оценка практической значимости:

Уменьшение артериального давления на 8.37 единиц может иметь практическое значение, если это изменение может повлиять на здоровье пациентов и/или снизить риск сердечно-сосудистых заболеваний.

# Гипотеза 3. Внедрение программы реабилитации для пациентов с хронической болью в спине приведет к улучшению их физической активности (предположим что физическую активность можно оценить по шкале 0-100)

## Генерация данных 

```{r}
# Воспроизводимость результатов
set.seed(42)

# Размер выборки 
sample_size <- 30

# В популяции до реабилитации средний уровень физической активности меньше (50 vs 60) 
# Генерация данных до реабилитации
before <- rbinom(sample_size, size = 100, prob = 0.5)

# Генерация данных после реабилитации
after <- rbinom(sample_size, size = 100, prob = 0.6)

# Создание таблицы данных
data <- data.frame(before, after)
```

## Решение

* Сформулируем гипотезы:

Нулевая гипотеза (H0): Нет различий в среднем уровне физической активности до и после программы реабилитации.
Альтернативная гипотеза (H1): Существует различие в среднем уровне физической активности до и после программы реабилитации.

* Уровень значимости (α):

Обычно принимается стандартный уровень значимости 0.05.

* Статистический тест (критерий):

Мы будем использовать t-тест для зависимых выборок, так как измерения до и после являются зависимыми.

* Критическое значение статистики:

$t=2.0452$


```{r}
# Расчет статистики и p-value
t_test_result <- t.test(data$before, data$after, paired = TRUE)
t_test_result
```

* Наблюдаемое значение статистики:

$t=-7.4892$

* Оценка статистической значимости:

$p-value=2.966e-08$
Отвергаем нулевую гипотезу. Доверительный интервал От (-13.12  -7.54). Не вулючает 0. Это интервал, который охватывает истинное различие средних значений с 95% вероятностью.

* Оценка практической значимости:

Оценка среднего различия -10.37 указывает на существенное снижение уровня боли в спине у пациентов после реабилитации.

# Гипотеза 4. Применение нового метода лечения для пациентов с инфарктом миокарда увеличит долю вернувшихся к нормальной физической активности 

## Генерация данных 

```{r}
# Воспроизводимость результатов
set.seed(42)

# Общий размер выборки
sample_size <- 200

# Генерация данных по статусу лечение (бинарная переменная, новый метод или стандарт) в фиксированном соотношении 1:1
treatment <- sample(c("новый метод", "стандарт"), size = sample_size, replace = TRUE)

# Генерация данных по физической активности после лечения (бинарная переменная)
# В популяции экспериментального лечения вероятность нормальной физической активности больше (0.7 vs 0.65)
activity <- ifelse(treatment == "новый метод", rbinom(sample_size, 1, 0.7), rbinom(sample_size, 1, 0.65))
```

## Решение

* Сформулируем гипотезы:

Нулевая гипотеза (H0): Нет различий в доле вернувшихся к нормальной физической активности между группами с новым методом лечения и группой со стандартным лечением.
Альтернативная гипотеза (H1): Существует различие в доле вернувшихся к нормальной физической активности.
Уровень значимости (α):

Обычно принимается стандартный уровень значимости 0.05.

* Статистический тест (критерий):

Мы будем использовать z-тест для разности долей, так как у нас бинарные переменные.

* Критическое значение статистики:

$\chi^2=3.841$


```{r eval=FALSE}
# Создание таблицы сопряженности
treatment_activity_table <- table(treatment, activity)

# Проведение Z-теста для разности долей
z_test_result <- prop.test(treatment_activity_table[, 1], n = colSums(treatment_activity_table), alternative = "two.sided")
z_test_result
```
* Наблюдаемое значение статистики:

$\chi^2=11.549$

* Оценка статистической значимости:

$p-value=0.000678$ 

Отвергаем нулевую гипотезу.

* Оценка практической значимости:

Абсолютная разница в долях между новым методом и стандартным методом равна приблизительно 
$$RD=0.4839-0.231=0.252$$
Это означает, что на каждые 100 пациентов, применяющих новый метод лечения, примерно 25 больше вернутся к нормальной физической активности по сравнению со стандартным методом.

# Гипотеза 5. Применение медитации в течение 8 недель повлияет на наличие стресса (есть/нет) у лиц с высоким уровнем тревожности.

## Генерация данных 

```{r}
# Воспроизводимость результатов
set.seed(42)

# Размер выборки
sample_size <- 50

# Генерация данных до медитации (бинарная переменная) в фиксированном соотношении 1:1
before <- rbinom(sample_size, 1, 0.4)

# Генерация данных после медитации (бинарная переменная). После медитации вероятность наличия стресса меньше (0.2 vs 0.4)
after <- rbinom(sample_size, 1, 0.2)
```

## Решение

* Сформулируем гипотезы:

Нулевая гипотеза (H0): Нет разницы в доле стресса до и после медитации.
Альтернативная гипотеза (H1): Существует разница в доле стресса до и после медитации.

* Уровень значимости (α):

Обычно принимается стандартный уровень значимости 0.05.

* Статистический тест (критерий):

Используем McNemar's test для связанных выборок.


```{r}
# Создание таблицы сопряженности
contingency_table <- table(before, after)

# Расчет статистики и p-value
mcnemar_test_result <- mcnemar.test(contingency_table)
mcnemar_test_result
```
* Наблюдаемое значение статистики:

$McNemar's \chi^2=16.69$

* Оценка статистической значимости:

$p-value=4.402e-05$

Отвергаем нулевую гипотезу.

# Гипотеза 6. Применение альтернативного метода лечения для пациентов с биполярным расстройством приведет к значимому изменению уровня симптомов депрессии по отношению к группе, прошедшей стандартное лечение (депрессию можно определить по шкале от 0 до 100, при этом исследователь должен избежать любых предположений (кроме i.i.d.)).

* Сформулируем гипотезы:
Нулевая гипотеза (H0): Средние уровни симптомов депрессии у пациентов, получающих альтернативное лечение, и у пациентов, получающих стандартное лечение, равны. 
Альтернативная гипотеза (H1): Средние уровни симптомов депрессии в двух группах различаются.

* Уровень значимости (α):

Обычно принимается стандартный уровень значимости 0.05.

* Статистический тест (критерий):
Для сравнения средних значений двух независимых групп может использоваться Welch Two Sample t-test.

* Критическое значение статистики:

$t=3.841$


## Генерация данных 

```{r}
# Воспроизводимость результатов
set.seed(42)

# Размер выборки для каждой группы
sample_size <- 20

# В популяции c экспериментальным методом лечения средний депрессии меньше (55 vs 68) 
# Генерация данных для экспериментальной группы 
group1 <- rnorm(sample_size, mean = 55, sd = 10)  # экспериментальная группа

# Генерация данных для группы со стандартным лечением
group2 <- rnorm(sample_size, mean = 68, sd = 10)  # контрольная группа
```

## Решение

```{r}
# Расчет статистики и p-value
t_test_result <- t.test(group1, group2)
t_test_result

```
* Наблюдаемое значение статистики:

$t=2.0262$

* Оценка статистической значимости:

$p-value=4.402e-05$

Отвергаем нулевую гипотезу.

* Оценка практической значимости:
Оценкаразличия среднего (8,37) также может быть использована для оценки клинической значимости изменений в практическом контексте.

# Гипотеза 7. Длительность сна (в часах) ассоциирована с уровенем стресса у студентов (шкала с нормальным распределением)

* Сформулируем гипотезы:

Нулевая гипотеза (H0): Нет корреляции между длительностью сна и уровнем стресса у студентов.
Альтернативная гипотеза (H1): Существует отличающаяся от нуля корреляция между длительностью сна и уровнем стресса у студентов.

* Уровень значимости (α):

Обычно принимается стандартный уровень значимости 0.05.

* Статистический тест (критерий):

Используется тест корреляции Пирсона (Pearson's product-moment correlation).

* Критическое значение статистики:

$t=-1.984$


## Генерация данных  

```{r}

library(mvtnorm) # библиотека mvtnorm для работы с многомерным нормальным распределением

# Воспроизводимость результатов
set.seed(42)

# Размер выборки
sample_size <- 100

# Средние значения для длительности сна (HoursOfSleep) и уровня стресса (StressLevel) в популяции
means <- c(7, 5)  

# Матрица ковариации. В ислледуемой популяции HoursOfSleep и StressLevel ассоциированы отрицательно (r = -0.5)
cov_matrix <- matrix(c(1, -0.5, -0.5, 1), nrow = 2)

# Генерация данных из многомерного нормального распределения
df <- rmvnorm(n = sample_size, 
              mean = means, 
              sigma = cov_matrix) %>% 
      as_tibble() %>%
      setNames(c("HoursOfSleep", "StressLevel"))

```

## Решение (дополните решение визуализацией)

```{r}

# Расчет статистики и p-value
cor_test_result <- cor.test(df$HoursOfSleep, df$StressLevel, method = "pearson")
cor_test_result
```
* Наблюдаемое значение статистики:

$t=-6.0621$

* Оценка статистической значимости:

$p-value=2.511e-08$
Отвергаем нулевую гипотезу.

* Оценка практической значимости:

Оценка корреляции составляет -0.522, что говорит о умеренной обратной корреляции между длительностью сна и уровнем стресса. Таким образом, при увеличении длительности сна, уровень стресса имеет тенденцию снижаться. 

```{r}
# Подключение библиотек для визуализации
library(ggplot2)

# График рассеяния и линия линейной регрессии с коэффициентом корреляции
combined_plot <- ggplot(df, aes(x = HoursOfSleep, y = StressLevel)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE, color = "blue") +
  labs(title = "График рассеяния и линия линейной регрессии с коэффициентом корреляции",
       x = "Длительность сна (в часах)",
       y = "Уровень стресса") +
  geom_text(aes(label = paste("Корреляция =", round(cor_test_result$estimate, 2))),
            x = 5, y = 6.5, color = "red", size = 4)

print(combined_plot)
```





